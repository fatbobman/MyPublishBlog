<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"/><meta name="og:site_name" content="肘子的Swift记事本"/><link rel="canonical" href="https://www.fatbobman.com/posts/healthNote2-development-memo-1"/><meta name="twitter:url" content="https://www.fatbobman.com/posts/healthNote2-development-memo-1"/><meta name="og:url" content="https://www.fatbobman.com/posts/healthNote2-development-memo-1"/><title>健康笔记 2.0 开发随笔（一） | 肘子的Swift记事本</title><meta name="twitter:title" content="健康笔记 2.0 开发随笔（一） | 肘子的Swift记事本"/><meta name="og:title" content="健康笔记 2.0 开发随笔（一） | 肘子的Swift记事本"/><meta name="description" content="健康笔记从 2020 年 1 月上线以来，至今已经过了大半年的时间（可以从 [老人新兵 —— 一款 iOS app 的开发手记](https://zhuanlan.zhihu.com/p/103822455) 了解健康笔记 app 的由来）。在这段时间里，我对于 Swift、SwiftUI、CoreData 等都有了进一步的了解和认识。在开发 1.0 版本时所面对的问题和疑惑多数都得到了解决。"/><meta name="twitter:description" content="健康笔记从 2020 年 1 月上线以来，至今已经过了大半年的时间（可以从 [老人新兵 —— 一款 iOS app 的开发手记](https://zhuanlan.zhihu.com/p/103822455) 了解健康笔记 app 的由来）。在这段时间里，我对于 Swift、SwiftUI、CoreData 等都有了进一步的了解和认识。在开发 1.0 版本时所面对的问题和疑惑多数都得到了解决。"/><meta name="og:description" content="健康笔记从 2020 年 1 月上线以来，至今已经过了大半年的时间（可以从 [老人新兵 —— 一款 iOS app 的开发手记](https://zhuanlan.zhihu.com/p/103822455) 了解健康笔记 app 的由来）。在这段时间里，我对于 Swift、SwiftUI、CoreData 等都有了进一步的了解和认识。在开发 1.0 版本时所面对的问题和疑惑多数都得到了解决。"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@fatbobman"/><meta name="twitter:creator" content="@fatbobman"/><meta name="referrer" content="no-referrer"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/images/css/code.css" type="text/css"/><link rel="stylesheet" href="/images/css/toc.css" type="text/css"/><link rel="stylesheet" href="/images/css/search.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to 肘子的Swift记事本"/><meta name="twitter:image" content="https://www.fatbobman.com/images"/><meta name="og:image" content="https://www.fatbobman.com/images"/><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-95XGB44EJH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-95XGB44EJH');
</script><link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css"/><meta name="theme-color" content="#C62F1C"/></head><body class="item-page"><header><div class="wrapper"><div class="logo"><a href="/"><img src="/images/title_version2.svg"/></a></div><div><div class="headerIcons"><a class="icon headIconTwitter" href="https://www.twitter.com/fatbobman" target="_blank" rel="noreferrer"></a><a class="icon headIconEmail" href="mailto:xuyang@me.com" target="_blank" rel="noreferrer"></a><a class="icon headIconGithub" href="https://github.com/fatbobman/" target="_blank" rel="noreferrer"></a><a class="icon headIconZhihu" href="https://www.zhihu.com/people/fatbobman3000" target="_blank" rel="noreferrer"></a><a class="icon headIconRss" href="/feed.rss" target="_blank" rel="noreferrer"></a></div></div><nav><ul><li><a href="/">最近更新</a></li><li><a class="selected" href="/posts">全部文章</a></li><li><a href="https://www.fatbobman.com/healthnotes">健康笔记</a></li><li><a href="/about">关于</a></li><li><a href="/tags">搜索</a></li></ul><div class="weixinHeadQcode" onclick="$('.weixinHeadQcode').css('display','none');"></div></nav></div></header><div class="container"><div class="wrapper"><div class="viewContainer"><div class="leftContent"><div class="post-actions"><div class="actionButton"><div class="actionButton twitter" onclick="window.open('https://twitter.com/intent/tweet?text=健康笔记 2.0 开发随笔（一）&url=https://www.fatbobman.com/posts/healthNote2-development-memo-1&via=fatbobman','target','');"></div></div><div class="actionButton"><div class="actionButton comment" onclick="$('html,body').animate({scrollTop: $('#gitalk-container').offset().top }, {duration: 500,easing:'swing'})"></div></div></div><article><div class="post-title"><h1>健康笔记 2.0 开发随笔（一）</h1></div><div><ul class="tag-list"><li class="tag variant-5"><a href="/tags/swiftui">SwiftUI</a></li><li class="tag variant-7"><a href="/tags/健康笔记">健康笔记</a></li><li class="tag tagdate">发布于2020年08月17日</li></ul><div class="content"><blockquote><p>健康笔记从 2020 年 1 月上线以来，至今已经过了大半年的时间（可以从 <a href="https://zhuanlan.zhihu.com/p/103822455" target="_blank">老人新兵 —— 一款 iOS app 的开发手记</a> 了解健康笔记 app 的由来）。在这段时间里，我对于 Swift、SwiftUI、CoreData 等都有了进一步的了解和认识。在开发 1.0 版本时所面对的问题和疑惑多数都得到了解决。</p></blockquote><p>最近随着 iOS14 发布的临近，同时也想将这短时间来学习的知识进行更系统的整理和应用，于是便将健康笔记 2.0 的开发工作提上了日程，并已经着手进行中。</p><Div id = "responser" class = "responser" ><div class = "adsContent"><style>.adsImage {   content:url("https://cdn.fatbobman.com/BlogHealthNotesAdsPic.png")}@media (prefers-color-scheme: dark) {  .adsImage {       content:url("https://cdn.fatbobman.com/BlogHealthNotesAdsDarkPic.png")  }}</style><div class = "HStack"><img class = "adsImage"></img><div class = "textContainer"><div class = "title">健康笔记 - 全家人的健康助手 </div><div class = "document"><p>健康笔记适用于任何有健康管理需求的人士。提供了强大的自定义数据类型功能，可以记录生活中绝大多数的健康项目数据。你可以为每个家庭成员创建各自的记录笔记，或者针对某个特定项目、特定时期创建对应的笔记。</p></div></div></div></div><div class='label'>推荐</div></Div><script type="text/javascript">
$(document).ready(function() {
   var banners = [];
   var index = 0;
   $("#responser").on("click",function(){
    window.location.href = "http://www.fatbobman.com/healthnotes/"
});
  });
</script><h2>健康笔记 2.0 的规化</h2><ul><li>功能</li></ul><p>健康笔记 1.0 目前的功能已基本能够满足我个人的日常使用，在上线这段时间内，我也根据用户提出的建议增加了部分新功能。因此在 2.0 上，app 核心功能的增加并不是太多，主要集中在两点：</p><ul><li>数据类型</li></ul><p>1.0 中当前支持两种数据类型，一种是数字型（仅记录一个数字+日期），另一个是选项型（自定义选项内容+日期），在 2.0 中，新增了其他 5 中数据类型包括：双数字型、数字选项型、起始时间型等。使用者可以记录生活中更多种类的内容。</p><ul><li>数据导入导出</li></ul><p>1.0 中已经提供了对于数字卡片、条目等内容的数据各自的导出支持（csv,pdf,xslx）,2.0 版中将提供同一的导出入口，并将提供导入功能。用户可以有更多段选择保管并使用自己的数据，比如将自己创建的卡片分享给其他用户，或者重新导入自己保存的离线数据等。</p><p>既然是一次大版本的更新，虽然在功能上的改变并非太多，但在其他地方的变化还是会很大的，更多的变化都会在后文中提到。</p><h2>开发环境、框架</h2><p>Xcode12 + SwiftUI2.0 ，主要的原因如下：</p><ul><li>从 WWDC20 以来我一直在跟踪并学习 iOS14 下的新特性（我的最近的文章大多都有关于此），以及 SwiftU2.0 中提供的新功能。在规划初始，我打算在 2.0 中使用不少的新功能来完成自己的构思。由于 iOS14 对于硬件的支持完全涵盖的之前 iOS13 的机型，相信对于 iOS13 的用户来说，更新的阻力不会太大。</li></ul><ul><li>当前的用户数并不多，历史包袱较小。从上线来，目前健康笔记的总下载量才刚刚超过 1000，因此让我可以轻装上阵，有较大的调整空间。</li><li>1.0 版本中很多的规划、设计不完善。最近几个月，我已经很少向 1.0 版本中增加新的功能了，主要原因就是最开始的结构设计不合理、代码混乱。如果强行添加更多的功能，只会导致留下更多的隐患，反倒不利于今后的调整。所以在 2.0 中，决定将之前的数据结构设计进行了较大的改变，将 1.0 的代码全部推翻重写。</li><li>数据迁移的问题。由于 1.0 的数据结构设计不佳，我打算在 2.0 中进行大变化，这样会导致 CoreData 的数据迁移面临严峻的考验。在 1.0 版本的数据小升级中，我已经领教到了 CoreData 的迁移机制所带来的便利性和难以控制的双面问题。尽管可以通过编写自己的 CoreData 迁移代码来解决结构大变化时所面临的难题，不过为了不留下隐患、给将来的扩充留下更自由的空间，还是决定放弃了使用 CoreData 的迁移机制。</li><li>我本来就打算在 2.0 中进一步加强数据的导入导出，所以对于 1.0 版本的用户，我将提供安全的数据迁移能力，平滑的过度到 2.0 上。</li></ul><p>结果就是：用户将重新在 app store 上下载健康笔记 2.0app（不是在 1.0 上更新），2.0 将支持 iOS14、macOS 11 及以上的系统。之前的健康笔记 1.0 用户数据都可以安全方便的手动转移到 2.0 版本上。</p><ul><li>支持多平台</li></ul><p>2.0 将支持 iPhone,iPad 和 macOS。</p><p>SwiftUI 本身对于多平台的支持就非常出色，不过为了能够在不同的硬件平台下更好的发挥其各自的特点，我还是决定为支持多平台做更多针对性的调整。</p><ul><li>iPhone 下仍同 1.0 一样强制竖屏使用。</li></ul><ul><li>iPad 下强制横屏使用，并采用了和 iPhone 下完全不同的布局。</li></ul><ul><li>macOS 下不使用 Catalyst，而使用原生的 macOS target 进行编写。虽然加大了工作量，但可以更好的适配桌面操作，尤其是提供同手指操作完全不同键鼠交互逻辑，并采用更适合桌面平台的布局和控件操作。</li></ul><ul><li>我在最近编写的 Swift 库中，基本上都提供了跨平台的支持。</li></ul><ul><li>由于决定了进行完全的跨平台开发（uikit+appkit），因此在选择第三方库的限制将会更多。<ul></ul></li></ul><ul><li>多语种</li></ul><p>健康笔记的本身的文字量并不多，因此单纯从文本内容的角度来看，多语种支持并不复杂。不过由于涉及了不少的数据显示、日期计算等，在真正进行多语种支持的时候还是遇到了不少挑战。</p><p>在目前的开发版本中，已经可以让用户在 app 中单独设置语言、时区而不完全依赖系统设定。</p><p>目前仍没有想好的多语种支持问题主要存在于 Demo 数据的加载上。我希望能找到一个工作量较小、数据量较小的解决方案。</p><h2>代码结构</h2><p>健康笔记 2.0 将代码完全推翻重写，其中极为重要的一个原因是我想实现一个自己认可的能适用于 SwiftUI 的 MVVM 结构。</p><p>我在开发 1.0 版本的时候才接触到 MVVM，在最初的开发过程中，基本上是按照别人提供的代码逻辑来完成的。在实际的使用中一方面发现了很多自己不理解或用起来不顺手的地方，同时在不断的学习中，也发现了很多传统 MVVM 不完适应 SwiftUI 框架的问题。最近几个月，我一直在学习并研究适用于 SwfitUI 的 MVVM 结构，2.0 的开发中这些学习结果将得到充分的检验机会。</p><p>Xcode12 中提供了 SwiftUI lifecycle，从程序入口点，到 App Delegate、Scene Delegate 响应都有了彻底地改变，如何设计一个更适合 Swfit2.0 的状态机在不少论坛进行了讨论和分析。我目前在开发中采用的结构对这些都做了有针对性的调整。并且为多平台，多语种都提供不错的响应支持。同时为了便于使用 Preview，对于 CoreData 的声明和注入也做了针对性的调整。</p><p>之后，我会专门写一篇关于这方面的文章和大家一起研究谈探讨。</p><h2>商业计划</h2><p>没有。</p><p>由于编写代码仅是我的个人爱好，对于健康笔记这个项目，我完全是为了满足自己的需要而开发的。因此，在健康笔记上我是没有任何商业规划和愿望与想法的。只要我的精力允许，身体状态 ok，我就会坚持吧这个 app 完善下去。</p><p>我将在开发过程中，不定时地更新随笔。一方面对自己的思路进行一个梳理，同时也希望能够给其他的个人开发者提供一点参考。</p><p><a href="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=1492861358" target="_blank">健康笔记 1.0 下载</a></p></div><div class="license"><p>本博客文章采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC 4.0 协议</a>，转载需注明出处和作者。</p></div></div></article><div class="item-navigator"><table><tr><td class="previous-item"><a href="/posts/swiftui-list-foreach">聊一下 SwiftUI 中的 List 和 ForEach</a></td><td class="next-item"><a href="/posts/swifui-overlay">SwiftUIOverlayContainer ——可以实现各种自定义样式弹出视图的 SwitUI 库</a></td></tr></table></div><div id="gitalk-container"></div>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
var gitalk = new Gitalk({
clientID: 'fcf61195c7f73253dc8b',
clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
repo: 'blogComments',
owner: 'fatbobman',
admin: ['fatbobman'],
id: '健康笔记 2.0 开发随笔（一）'.split("/").pop().substring(0, 49),      // Ensure uniqueness and length less than 50
distractionFreeMode: true,  // Facebook-like distraction free mode
createIssueManually: true,
language: 'zh-CN'
});

gitalk.render('gitalk-container');

</script></div><div class="side-nav"><div class="sidebar"></div></div>    <script src="/images/toc.js"></script></div></div><footer><p>Copyright &copy; 东坡肘子 (Fatbobman) 2022 <a href="http://beian.miit.gov.cn">辽ICP备20006550</a></p><p>Generated using <a href="https://github.com/johnsundell/publish" target="_blank">Publish</a></p><ul class="icon"><li><a href="https://twitter.com/fatbobman" target="_blank"><img class="twitter" src="/images/twitter.svg"/></a></li><li><a href="https://github.com/fatbobman/" target="_blank"><img src="/images/github.svg"/></a></li><li><a href="https://www.zhihu.com/people/fatbobman3000" target="_blank"><img src="/images/zhihu.svg"/></a></li><li><a href="/feed.rss"><img src="/images/rss.svg"/></a></li></ul><script>
    // dynamic User by Hux
    var _gaId = 'UA-165296388-1';
    var _gaDomain = 'fatbobman.com';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>

<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '14e5d60a3ea6276655f9d14c58b1fcd0';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script></footer></div></body></html>