<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"/><meta name="og:site_name" content="肘子的Swift记事本"/><link rel="canonical" href="https://www.fatbobman.com/posts/healthNote2-development-memo-5"/><meta name="twitter:url" content="https://www.fatbobman.com/posts/healthNote2-development-memo-5"/><meta name="og:url" content="https://www.fatbobman.com/posts/healthNote2-development-memo-5"/><title>健康笔记 2.0 开发随笔（五） | 肘子的Swift记事本</title><meta name="twitter:title" content="健康笔记 2.0 开发随笔（五） | 肘子的Swift记事本"/><meta name="og:title" content="健康笔记 2.0 开发随笔（五） | 肘子的Swift记事本"/><meta name="description" content="一晃国庆中秋长假即将结束，距离上次的随笔也有了一段时间。在最近的日子里，我一方面继续着开发的进程，同时还要付出相当的精力同 iOS14 中的各种 Bug 和异常斗智斗勇。本篇随笔主要记录了这段时间碰到的一些问题，以及聊聊 iOS14、Xcode12 以及 SwiftUI2.0 的一些优缺点。想到哪、写到哪，可能逻辑会比较混乱。"/><meta name="twitter:description" content="一晃国庆中秋长假即将结束，距离上次的随笔也有了一段时间。在最近的日子里，我一方面继续着开发的进程，同时还要付出相当的精力同 iOS14 中的各种 Bug 和异常斗智斗勇。本篇随笔主要记录了这段时间碰到的一些问题，以及聊聊 iOS14、Xcode12 以及 SwiftUI2.0 的一些优缺点。想到哪、写到哪，可能逻辑会比较混乱。"/><meta name="og:description" content="一晃国庆中秋长假即将结束，距离上次的随笔也有了一段时间。在最近的日子里，我一方面继续着开发的进程，同时还要付出相当的精力同 iOS14 中的各种 Bug 和异常斗智斗勇。本篇随笔主要记录了这段时间碰到的一些问题，以及聊聊 iOS14、Xcode12 以及 SwiftUI2.0 的一些优缺点。想到哪、写到哪，可能逻辑会比较混乱。"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@fatbobman"/><meta name="twitter:creator" content="@fatbobman"/><meta name="referrer" content="no-referrer"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/images/css/code.css" type="text/css"/><link rel="stylesheet" href="/images/css/toc.css" type="text/css"/><link rel="stylesheet" href="/images/css/search.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to 肘子的Swift记事本"/><meta name="twitter:image" content="https://www.fatbobman.com/images"/><meta name="og:image" content="https://www.fatbobman.com/images"/><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-95XGB44EJH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-95XGB44EJH');
</script><link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css"/><meta name="theme-color" content="#C62F1C"/></head><body class="item-page"><header><div class="wrapper"><div class="logo"><a href="/"><img src="/images/title_version2.svg"/></a></div><div><div class="headerIcons"><a class="icon headIconTwitter" href="https://www.twitter.com/fatbobman" target="_blank" rel="noreferrer"></a><a class="icon headIconEmail" href="mailto:xuyang@me.com" target="_blank" rel="noreferrer"></a><a class="icon headIconGithub" href="https://github.com/fatbobman/" target="_blank" rel="noreferrer"></a><a class="icon headIconZhihu" href="https://www.zhihu.com/people/fatbobman3000" target="_blank" rel="noreferrer"></a><a class="icon headIconRss" href="/feed.rss" target="_blank" rel="noreferrer"></a></div></div><nav><ul><li><a href="/">最近更新</a></li><li><a class="selected" href="/posts">全部文章</a></li><li><a href="https://www.fatbobman.com/healthnotes">健康笔记</a></li><li><a href="/about">关于</a></li><li><a href="/tags">搜索</a></li></ul><div class="weixinHeadQcode" onclick="$('.weixinHeadQcode').css('display','none');"></div></nav></div></header><div class="container"><div class="wrapper"><div class="viewContainer"><div class="leftContent"><div class="post-actions"><div class="actionButton"><div class="actionButton twitter" onclick="window.open('https://twitter.com/intent/tweet?text=健康笔记 2.0 开发随笔（五）&url=https://www.fatbobman.com/posts/healthNote2-development-memo-5&via=fatbobman','target','');"></div></div><div class="actionButton"><div class="actionButton comment" onclick="$('html,body').animate({scrollTop: $('#gitalk-container').offset().top }, {duration: 500,easing:'swing'})"></div></div></div><article><div class="post-title"><h1>健康笔记 2.0 开发随笔（五）</h1></div><div><ul class="tag-list"><li class="tag variant-5"><a href="/tags/swiftui">SwiftUI</a></li><li class="tag variant-7"><a href="/tags/健康笔记">健康笔记</a></li><li class="tag tagdate">发布于2020年10月07日</li></ul><div class="content"><p>一晃国庆中秋长假即将结束，距离上次的随笔也有了一段时间。在最近的日子里，我一方面继续着开发的进程，同时还要付出相当的精力同 iOS14 中的各种 Bug 和异常斗智斗勇。</p><p>本篇随笔主要记录了这段时间碰到的一些问题，以及聊聊 iOS14、Xcode12 以及 SwiftUI2.0 的一些优缺点。想到哪、写到哪，可能逻辑会比较混乱。</p><Div id = "responser" class = "responser" ><div class = "adsContent"><div class = "HStack"><img src = "https://cdn.fatbobman.com/BlogHealthNotesAdsPic.png"></img><div class = "textContainer"><div class = "title">健康笔记 - 全家人的健康助手 </div><div class = "document"><p>健康笔记适用于任何有健康管理需求的人士。提供了强大的自定义数据类型功能，可以记录生活中绝大多数的健康项目数据。你可以为每个家庭成员创建各自的记录笔记，或者针对某个特定项目、特定时期创建对应的笔记。</p></div></div></div></div><div class='label'>推荐</div></Div><script type="text/javascript">
$(document).ready(function() {
   var banners = [];
   var index = 0;
   $("#responser").on("click",function(){
    window.location.href = "http://www.fatbobman.com/healthnotes/"
});
  });
</script><h2>Bug 实在多</h2><p>2020 年苹果想在软件架构层面做出非常多的重要改变。big sur 要支持 arm，SwiftUI 要真正做到一套代码顺利的多平台运行，iOS14 也作出了在近几年肉眼可见的最大变化。不过可能是目标太多、太大，而时间又紧，至少到现在为止，bug 层出不穷，改不胜改。尤其是随着版本的升级，竟然出现了不少前面完全不曾出现的 bug，实在是令人心烦。</p><p>比如在 iOS14.2beta2 中，sheet 的 Delegate 无法响应，而在之前的所有版本都没有问题。在 iOS14.2beta2 中，View 的刷新时机有和之前有了细微的变化，在一些及特殊的情况下会出现刷新不同步。总之类似的错误一直在增加。</p><p>对于@FetchRequest 中的数据进行修改，View 不会自动更新，尽管 14.2 对于 List 做了修复，但在其他情况下，还是需要人为干预。</p><p>@FetechRequest 的数据进行增减时，有时会有动画，有时没有动画。同样的代码，在不同的地方，有时会有动画，有时没有动画，而这些都是在 SwiftUI1.0 版本都不曾出现的问题。</p><p>在 mac 下通过 catalyst 运行 app 时，总是会出现假死情况（系统 cup 占用为 0，就是 app 没有响应）。</p><p>Xcode12 各种现实异常，这两天出现了一个异常奇怪的现象，当我编辑 xcdatamodeld 文件时，屏幕上出现了一篇白色区域遮盖了数据编辑区，我只能盲操作。而编辑其他任何文件都没有这种情况。</p><p>Xcode12 的代码补全远不如 Xcode11，总是补全后需要删除大量无用的补全信息。</p><p>fileImporter 竟然不能通过手势取消，如果使用手势，会反复弹出 sheet，除非你点击右上角的 cancel。</p><p>Menu（SwiftUI 新增的控件） 在被键盘遮挡后会出现异常，所以我目前只能把 Menu 放置在屏幕的上方</p><p>ContextMenu 点选后总要闪烁一下，让人很不舒服。</p><p>在 SwiftUI2 中，对于键盘的自动避让本来是一个相当不错的设计，但总会导致大量的布局受键盘浮动的影响，反倒需要做更多的工作来避免这种情况，结果是好的想法但实现起来适得其反。</p><p>Xcode12 的 Debug 区域会丢失，可以通过快捷键重新唤出。而且莫名其妙的总是默认不显示右侧的 Debug Output 窗口。</p><p>上面所说的都是最近让我特别心烦的一些 bug，其他的实在是太多，就不一一例举了。</p><p>bug 过多的结果就是导致我需要花费大量的时间来了判断是我自己的实现错误还是由于系统的 bug 导致的。如果确定是 bug，还需要写不少的 feedback 给苹果，希望它能尽快修复。对于时间的浪费是十分巨大的。</p><p>为了判断是什么原因导致的，我目前在 mac 上安装了 两个版本的 big sur（最新版、次新版），三个版本的 Xcode(11.7,12.01,12.2beta2), 两个运行不同版本的 iphone(14.2beta2,14.01), 两个模拟器（14.2，14.01）。总之有够花费精力的。</p><p>不过这也是在一个尚未完全成熟的架构下，在一个巨大变化的时间点进行开发所要付出的必要代价。</p><h2>不小的进步</h2><p>上面进行了不少的吐槽，下面我们来说说苹果在今年给我们带来的进步和改善。</p><h3>Xcode12</h3><p>preview 已经很成熟了，已经很少会出现崩溃或无法预览的情况。</p><p>在 project 嵌入 playground 非常方便，尤其是打开 Build Active Scheme 之后，可以在 playground 中直接使用第三方库。对于开发中进行试验测试提供了巨大的便利。</p><p>StoreKit 的模拟环境非常有用，极大的提高了开发应用内付费的效率。可以在不提交 app 并建立资费的情况下便完成和调试所有和收费相关代码。不过我目前发现 restore 好像没有回馈，不知道是我的使用方法不对还是就是没有提供。</p><p>全屏开发模式支持直接在一次放置模拟器，提高了屏幕使用率，而且有助于注意力的提升。</p><p>SwiftUI liftcycle 让跨平台开发更加便利。</p><h3>SwiftUI</h3><p>onChange 是我对于今年 SwiftUI 改动最满意的地方。在 onChange 中的代码运行时机和 View 的 update 一直，基本可以保证正确的响应时机。</p><p>新的 DatePicker 在 iOS 上节省了显示的空间，让 form 更紧凑。不过选择后出现的闪烁还表示有进一步优化的空间</p><p>众多的新控件。进过我在本次开发中并没有使用太多的新控件，不过更多的选择还是有利于开发者的。</p><p>我目前最多使用的新控件有： toolbar menu lazyStack lazyGrid</p><p>在 DSL 中支持更复杂的逻辑判断。由于目前支持了 if let,switch 可以在 DSL 中用更少的代码实现更清晰的逻辑处理。</p><p>对于复杂的 DSL 的编译能力也有了提高</p><h3>Big Sur</h3><p>随着测试版本的不断提高，catalyst 对于 SwiftUI 的支持越来越好。在最初的版本中，基本还是利用 appkit 的控件来代替 uikit 的控件，在目前的 beta9 下，显示效果已经和 ipad 上相差无几。只是用 SwiftUI + catalyst 来开发 mac app 已经越来越有可能。</p><h2>测试征集</h2><p>健康笔记 2.0 目前已经到了收尾阶段，除了图表部分之外，大多数的功能都已完成。我正在申请 test flight 的 beta 测试。如果你有兴趣进行测试，请将你的邮箱发送给我。</p><p>健康笔记 2.0 需要运行在 iOS14 以上的设备。</p></div><div class="license"><p>本博客文章采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC 4.0 协议</a>，转载需注明出处和作者。</p></div></div></article><div class="item-navigator"><table><tr><td class="previous-item"><a href="/posts/healthnote2-release">健康笔记 2.0 正式版完成了！</a></td><td class="next-item"><a href="/posts/healthNote2-development-memo-4">健康笔记 2.0 开发随笔（四）</a></td></tr></table></div><div id="gitalk-container"></div>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
var gitalk = new Gitalk({
clientID: 'fcf61195c7f73253dc8b',
clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
repo: 'blogComments',
owner: 'fatbobman',
admin: ['fatbobman'],
id: '健康笔记 2.0 开发随笔（五）'.split("/").pop().substring(0, 49),      // Ensure uniqueness and length less than 50
distractionFreeMode: true,  // Facebook-like distraction free mode
createIssueManually: true,
language: 'zh-CN'
});

gitalk.render('gitalk-container');

</script></div><div class="side-nav"><div class="sidebar"></div></div>    <script src="/images/toc.js"></script></div></div><footer><p>Copyright &copy; 东坡肘子 (Fatbobman) 2022 <a href="http://beian.miit.gov.cn">辽ICP备20006550</a></p><p>Generated using <a href="https://github.com/johnsundell/publish" target="_blank">Publish</a></p><ul class="icon"><li><a href="https://twitter.com/fatbobman" target="_blank"><img class="twitter" src="/images/twitter.svg"/></a></li><li><a href="https://github.com/fatbobman/" target="_blank"><img src="/images/github.svg"/></a></li><li><a href="https://www.zhihu.com/people/fatbobman3000" target="_blank"><img src="/images/zhihu.svg"/></a></li><li><a href="/feed.rss"><img src="/images/rss.svg"/></a></li></ul><script>
    // dynamic User by Hux
    var _gaId = 'UA-165296388-1';
    var _gaDomain = 'fatbobman.com';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>

<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '14e5d60a3ea6276655f9d14c58b1fcd0';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script></footer></div></body></html>